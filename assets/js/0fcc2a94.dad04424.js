"use strict";(globalThis.webpackChunkdatabasement_docs=globalThis.webpackChunkdatabasement_docs||[]).push([[431],{2179:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"self-hosting/kubernetes-helm","title":"Kubernetes + Helm","description":"This guide will help you deploy Databasement on Kubernetes using Helm.","source":"@site/docs/self-hosting/kubernetes-helm.md","sourceDirName":"self-hosting","slug":"/self-hosting/kubernetes-helm","permalink":"/databasement/self-hosting/kubernetes-helm","draft":false,"unlisted":false,"editUrl":"https://github.com/David-Crty/databasement/tree/main/docs/docs/self-hosting/kubernetes-helm.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"selfHostingSidebar","previous":{"title":"Docker Compose","permalink":"/databasement/self-hosting/docker-compose"}}');var t=a(4848),i=a(8453);const r={sidebar_position:3},l="Kubernetes + Helm",o={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"1. Add the Helm Repository",id:"1-add-the-helm-repository",level:3},{value:"2. Generate an Application Key",id:"2-generate-an-application-key",level:3},{value:"3. Create a Values File",id:"3-create-a-values-file",level:3},{value:"Minimal Configuration (SQLite)",id:"minimal-configuration-sqlite",level:4},{value:"Production Configuration (External Database)",id:"production-configuration-external-database",level:4},{value:"Using Existing Secrets",id:"using-existing-secrets",level:4},{value:"4. Install the Chart",id:"4-install-the-chart",level:3},{value:"5. Verify the Deployment",id:"5-verify-the-deployment",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Custom Environment Variables",id:"custom-environment-variables",level:3},{value:"Environment Variables from Secrets/ConfigMaps",id:"environment-variables-from-secretsconfigmaps",level:3},{value:"Worker Configuration",id:"worker-configuration",level:3},{value:"Persistence",id:"persistence",level:3},{value:"Uninstalling",id:"uninstalling",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes--helm",children:"Kubernetes + Helm"})}),"\n",(0,t.jsx)(n.p,{children:"This guide will help you deploy Databasement on Kubernetes using Helm."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Kubernetes 1.19+"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm"})," 3.x"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"kubectl"})," configured for your cluster"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.h3,{id:"1-add-the-helm-repository",children:"1. Add the Helm Repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add databasement https://david-crty.github.io/databasement\nhelm repo update\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-generate-an-application-key",children:"2. Generate an Application Key"}),"\n",(0,t.jsx)(n.p,{children:"Before deploying, generate an application encryption key:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run --rm davidcrty/databasement:latest php artisan key:generate --show\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Copy the output (e.g., ",(0,t.jsx)(n.code,{children:"base64:abc123..."}),") for use in your values file."]}),"\n",(0,t.jsx)(n.h3,{id:"3-create-a-values-file",children:"3. Create a Values File"}),"\n",(0,t.jsx)(n.h4,{id:"minimal-configuration-sqlite",children:"Minimal Configuration (SQLite)"}),"\n",(0,t.jsx)(n.p,{children:"For simple deployments using SQLite:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'app:\n  url: https://backup.yourdomain.com\n  appKey:\n    value: "base64:your-generated-key-here"\n\ningress:\n  enabled: true\n  className: nginx\n  host: backup.yourdomain.com\n  # For HTTPS using cert-manager:\n  # tlsSecretName: databasement-tls\n  # annotations:\n  #   cert-manager.io/cluster-issuer: letsencrypt-prod\n'})}),"\n",(0,t.jsx)(n.h4,{id:"production-configuration-external-database",children:"Production Configuration (External Database)"}),"\n",(0,t.jsx)(n.p,{children:"For production, we recommend using MySQL or PostgreSQL instead of SQLite:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'# ... other app config\n\ndatabase:\n  connection: mysql  # or pgsql\n  host: your-mysql-host.example.com\n  port: 3306\n  name: databasement\n  username: databasement\n  password:\n    value: "your-secure-password"\n\ningress:\n  enabled: true\n  className: nginx\n  host: backup.yourdomain.com\n'})}),"\n",(0,t.jsx)(n.h4,{id:"using-existing-secrets",children:"Using Existing Secrets"}),"\n",(0,t.jsx)(n.p,{children:"For sensitive values, you can reference existing Kubernetes secrets instead of storing them in your values file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'app:\n  appKey:\n    fromSecret:\n      secretName: "my-app-secret"\n      secretKey: "APP_KEY"\n\ndatabase:\n  connection: mysql\n  host: mysql.example.com\n  name: databasement\n  username: databasement\n  password:\n    fromSecret:\n      secretName: "my-db-secret"\n      secretKey: "password"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"4-install-the-chart",children:"4. Install the Chart"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install databasement databasement/databasement -f values.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-verify-the-deployment",children:"5. Verify the Deployment"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods\nkubectl get svc\nkubectl get ingress\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["For the full list of configurable parameters, see the ",(0,t.jsx)(n.a,{href:"https://github.com/david-crty/databasement/blob/main/helm/databasement/values.yaml",children:"values.yaml"})," file."]}),"\n",(0,t.jsxs)(n.p,{children:["For all available environment variables, see the ",(0,t.jsx)(n.a,{href:"/databasement/self-hosting/configuration",children:"Configuration"})," page."]}),"\n",(0,t.jsx)(n.h3,{id:"custom-environment-variables",children:"Custom Environment Variables"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"extraEnv"})," to pass additional environment variables:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'extraEnv:\n  AWS_ACCESS_KEY_ID: "your-access-key"\n  AWS_SECRET_ACCESS_KEY: "your-secret-key"\n  AWS_DEFAULT_REGION: "us-east-1"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"environment-variables-from-secretsconfigmaps",children:"Environment Variables from Secrets/ConfigMaps"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"extraEnvFrom"})," to load environment variables from existing secrets or configmaps:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"extraEnvFrom:\n  - secretRef:\n      name: aws-credentials\n  - configMapRef:\n      name: app-config\n"})}),"\n",(0,t.jsx)(n.p,{children:"This is useful for injecting credentials managed by external secret management tools (e.g., External Secrets Operator, Sealed Secrets)."}),"\n",(0,t.jsx)(n.h3,{id:"worker-configuration",children:"Worker Configuration"}),"\n",(0,t.jsx)(n.p,{children:"The queue worker runs as a sidecar container by default. You can customize its behavior:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'worker:\n  enabled: true\n  command: "php artisan queue:work --queue=backups,default --tries=3 --timeout=3600"\n  resources:\n    limits:\n      cpu: 500m\n      memory: 512Mi\n    requests:\n      cpu: 100m\n      memory: 256Mi\n'})}),"\n",(0,t.jsx)(n.p,{children:"For high-availability setups with an external database, you can run the worker as a separate deployment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"worker:\n  separateDeployment: true\n  replicaCount: 2\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Separate worker deployment requires either ReadWriteMany storage or an external database (MySQL/PostgreSQL)."})}),"\n",(0,t.jsx)(n.h3,{id:"persistence",children:"Persistence"}),"\n",(0,t.jsx)(n.p,{children:"By default, persistence is enabled with a 10Gi volume:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'persistence:\n  enabled: true\n  storageClass: ""  # Uses default storage class\n  size: 10Gi\n  accessModes:\n    - ReadWriteOnce\n'})}),"\n",(0,t.jsx)(n.h2,{id:"uninstalling",children:"Uninstalling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm uninstall databasement\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)(n.p,{children:"This will not delete the PersistentVolumeClaim by default. To delete all data:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl delete pvc -l app.kubernetes.io/name=databasement\n"})})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>l});var s=a(6540);const t={},i=s.createContext(t);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);